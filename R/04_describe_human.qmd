---
title: "Describe file"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(tidyr)
library(patchwork)
```

Categorical variables: gene_id, cell_line, treatment, genotype

Numerical variables: expression_levels, log_expression_levels, log2foldchange

We check the distribution of expression levels

```{r}
DMSO_freq <- human_aug |> 
  filter(treatment == "DMSO") |> 
  ggplot(mapping = aes(x = expression_levels)) +
  geom_freqpoly()

G007.LK_freq <- human_aug |>
  filter(treatment == "G007.LK") |> 
  ggplot(mapping = aes(x = expression_levels)) +
  geom_freqpoly()

DMSO_freq + G007.LK_freq
```

We observe many observations equal to zero, but how many of them are there for each treatment?

```{r}
# Here "0.99 * min_pos_value" is equal to zero expression levels before adding the offset 
human_aug |> 
  filter(treatment == "DMSO") |> 
  summarise(DMSO_0 = sum(expression_levels == 0.99 * min_pos_value))

human_aug |>
  filter(treatment == "G007.LK") |> 
  summarise(G007.LK_0 = sum(expression_levels == 0.99 * min_pos_value))
```

We then check the distribution of expression levels after log2 transformation

```{r}
### DESC_3
 DMSO_freq_log <- human_aug |>
   filter(treatment == "DMSO") |>
   ggplot(mapping = aes(x = log2_expression_levels))+
   geom_freqpoly() #

 G007.LK_freq_log <- human_aug |>
   filter(treatment == "G007.LK") |>
   ggplot(mapping = aes(x = log2_expression_levels))+
   geom_freqpoly()


 DMSO_freq_log + G007.LK_freq_log
```

We can see now that the distribution is less skewed but we can still see that the majority of the observations are equal to zero (equal to -33.92 after the log2 transformation).

The bulk of zeros suggests that, for many genes in many cell lines, there is no difference in expression between the two conditions. This is a common observation, as many genes in different cell lines may not respond strongly to experimental conditions

`{# {r} # human_trans_wide |>  #   sample_n(50)|> #   ggplot(aes(x = cell_line,  #              y = gene_id,  #              fill = log2fc))+ #   geom_tile()+ #   scale_fill_gradientn(colors=c('blue','white','salmon'))+ #   theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),axis.text=element_text(size=4),axis.title=element_text(size=5))+ #   theme(legend.position = 'bottom',legend.key.size = unit(5, 'mm'),legend.title= element_text(size=5),legend.text=element_text(size=5))+ #   coord_fixed(ratio=0.6)`

```{r}
human_aug %>% 
  ggplot(aes(x = genotype , y =log2_expression_levels)) +
  geom_boxplot()
```

```{r}
human_joined %>% 
  ggplot(aes(x = cell_line, y = expression_levels, color = treatment))+
  geom_boxplot()+
  coord_flip()
```

```{r}
human_aug_log2fc %>% 
  mutate(cell_line = factor(human_aug_log2fc$cell_line, levels = (c("A375","FemxI", "FemxV", "LOX", "MeWo", "Skmel28", 
                                                "WM115", "WM1341", "WM1366", "WM1382", "WM239", 
                                                "WM266", "WM35", "WM45.1", "WM793", "WM852", "WM9", 
                                                "WM983"))))
```

```{r}
gene_diff <- human_aug_log2fc %>%
  group_by(gene_id) %>%
#  mutate(rank =(row_number(desc(abs(round(log2foldchange, 2)))))) %>%
 # filter(rank <= 4) %>% # we take the best 4 log2fchange
  ungroup() %>%
  select(gene_id,cell_line, log2foldchange)
```

```{r}

gene_diff <- human_aug_log2fc %>%
  group_by(gene_id) %>%
  mutate(rank =(row_number(desc(log2foldchange)))) %>%
  filter(rank <= 4) %>% # we take the best 4 log2fchange
  ungroup() %>%
  select(gene_id,cell_line, log2foldchange) 

gene_diff
```

```{r}
gene_diff %>% 
  ggplot(aes(x = cell_line, y = log2foldchange))+
  geom_boxplot()+
  coord_flip()
```

```{r}

```
