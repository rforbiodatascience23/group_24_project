---
title: "Analysis 1 file - Isolated analysis of the mouse dataset"
format: html
editor: visual
---

```{r}
#|label: load the packages
library(tidyverse)
library(stringr)
library(dplyr)
library(tidyr)
library(broom)
library(ggrepel)
source("../R/99_proj_func.R")
```

This analysis will see which genes are significantly up and down regulated in the treatment trials

Here we begin by loading the augmented mouse dataset

```{r}
Sys.setenv(VROOM_CONNECTION_SIZE = 3062144) # Setting a larger connection buffer to be able to load the data
# Loading the data
mouse_df <- read_tsv(file = "../data/04_dat_aug_mouse.tsv.gz")
```

First we loose the "Factor Value\[compound\]" (concentration) column since we don't need it in this analysis

```{r}
mouse_df = mouse_df |> 
  select(-c(`Factor Value[compound]`))

```

Now lets do an analysis to see which genes are significantly up and down regulated in each of the treatment trials.

```{r}
mouse_G007LK_lm <- generate_lm_genes(mouse_df, 'G007LK')
signif_genes_error_bars(mouse_G007LK_lm)

```

```{r}
volcano_plot(mouse_G007LK_lm)
```

```{r}
mouse_WNT_lm <- generate_lm_genes(mouse_df, 'WNT')
signif_genes_error_bars(mouse_WNT_lm)

```

```{r}
volcano_plot(mouse_WNT_lm)
```

```{r}
mouse_WNTG007LK_lm <- generate_lm_genes(mouse_df, 'WNT_G007LK')
signif_genes_error_bars(mouse_WNTG007LK_lm)

```

```{r}
volcano_plot(mouse_WNTG007LK_lm)
```

```{r}
combined_df <- bind_rows(
  mouse_WNT_lm,
  mouse_WNTG007LK_lm,
  mouse_G007LK_lm
)

significant_genes_df <- combined_df %>%
  filter(signif) %>%
  select(Gene, estimate, Treatment)

significant_genes_df %>% 
  ggplot(aes(x = Treatment,
           y = Gene,
           fill = estimate))+
    geom_tile()+
    scale_fill_gradient2(low = 'blue',
                         high ='red', 
                         midpoint= 0)+
    theme(axis.text.x = element_text(angle = 45, 
                                     vjust = 1, 
                                     hjust=1),
          axis.text=element_text(size=4),
          axis.title=element_text(size=5))+
    theme(legend.position = 'bottom',
          legend.key.size = unit(5, 'mm'),
          legend.title=element_text(size=5),
          legend.text=element_text(size=5))+
    coord_fixed(ratio=0.6)
```
