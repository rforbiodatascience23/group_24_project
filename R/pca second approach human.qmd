---
title: "Untitled"
format: html
editor: visual
---

PCA analysis using the LOG2goFOLD

```{r}
library(tidyverse) 
library(broom) 
library(dplyr) 
library(cowplot) 
library(purrr)

human_log2fc <- read_tsv(file = "../data/03_dat_aug_human_log.tsv.gz")
```

```{r}
human_log2fc
```

```{r}
# We have to identify which of the values are constant and creates a logical vector indicating which columns are constant

constant_cols<- human_log2fc |> 
  summarise_all(~ length(unique(.)) == 1) |> #identify columns that have constant values across all rows 
  unlist() |> 
  as.logical() #converts the resulting vector of true and false values into a logical vector
```

```{r}
#| cache: TRUE
filtered_data <- human_log2fc|> 
  select(-which(constant_cols))# exclude the constant columns
```

```{r}
#|cache: TRUE 
pca_result <- filtered_data |> 
  select_if(is.numeric) |> #selects the columns that are numeric 
  scale() |> #scales the columns 
  prcomp()
```

This is the plot corresponding the differences in expression between the different conditions

```{r}
pca_result |> 
  augment(data = human_log2fc) |> # add original dataset back in 
  ggplot(aes(.fittedPC1, 
             .fittedPC2, 
             color = cell_line)) + 
  geom_point(size = 1.5) + 
  geom_text_repel(mapping = aes(label = cell_line)) +
  theme_half_open(12) +
  background_grid() + 
  labs(x = "PC1(11.9%)", 
       y = "PC2(7.7%)", 
       title = "PCA plot defining the association of the Cell line Log2foldchange when using the G007.LK", 
       color= "Cell lines")
```

Rotation matrix

```{r}
pca_result |> 
  tidy(matrix = "rotation")
```

```{r}
pca_result |> 
  tidy(matrix = "eigenvalues")
```

```{r}
pca_result |> 
  tidy(matrix = "eigenvalues") |>
  ggplot(aes(PC, percent)) + 
  geom_col(fill = "#56B4E9", alpha = 0.8) +
  scale_x_continuous(breaks = 1:9) + 
  scale_y_continuous(labels = scales::percent_format(), 
                     expand = expansion(mult = c(0, 0.01))) +
  theme_minimal_hgrid(12)
```
